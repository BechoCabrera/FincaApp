<div class="ui-container ui-scrollable">
  <!-- ===== FORMULARIO ===== -->
  <section class="ui-card">
    <h3 class="section-title">Registro de Fincas</h3>

    <form [formGroup]="form" class="ui-form">
      <!-- fila 1 -->
      <mat-form-field appearance="fill" class="ui-field ui-field-6">
        <mat-label>Código</mat-label>
        <input matInput formControlName="codigo" placeholder="Ej: FIN-001" />
        <mat-error *ngIf="has('codigo', 'required')">Requerido</mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill" class="ui-field ui-field-6">
        <mat-label>Nombre</mat-label>
        <input matInput formControlName="nombre" placeholder="Nombre de la finca" />
        <mat-error *ngIf="has('nombre', 'required')">Requerido</mat-error>
      </mat-form-field>

      <!-- fila 2 -->
      <mat-form-field appearance="fill" class="ui-field-full">
        <mat-label>Descripción</mat-label>
        <textarea matInput formControlName="descripcion" rows="3"></textarea>
      </mat-form-field>

      <!-- acciones -->
      <div class="ui-actions ui-field-full">
        <button
          mat-flat-button
          type="button"
          style="background: var(--primary)"
          [disabled]="!formOk() || isSaving"
          (click)="guardarFinca()">
          {{ editingId ? 'Actualizar' : 'Guardar' }}
        </button>
      </div>
    </form>
  </section>

  <!-- ===== TABLA ===== -->
  <section class="ui-card brand-surface mt-3">
    <div class="mb-3 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
      <div class="flex items-center gap-3">
        <span
          class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium"
          style="background: var(--table-head-bg); color: var(--table-ink)">
          TOTAL DE FINCAS: {{ dataSource.data.length }}
        </span>
      </div>
    </div>

    <div class="ui-table-wrapper">
      <table mat-table [dataSource]="dataSource" class="mat-elevation-z1 ui-table">
        <!-- índice -->
        <ng-container matColumnDef="idx">
          <th mat-header-cell *matHeaderCellDef>#</th>
          <td mat-cell *matCellDef="let r; let i = index">
            {{ i + 1 }}
          </td>
        </ng-container>

        <ng-container matColumnDef="codigo">
          <th mat-header-cell *matHeaderCellDef>CÓDIGO</th>
          <td mat-cell *matCellDef="let r">
            <strong>{{ r.codigo }}</strong>
          </td>
        </ng-container>

        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef>NOMBRE</th>
          <td mat-cell *matCellDef="let r">{{ r.nombre }}</td>
        </ng-container>

        <ng-container matColumnDef="descripcion">
          <th mat-header-cell *matHeaderCellDef>DESCRIPCIÓN</th>
          <td mat-cell *matCellDef="let r">
            <span class="line-clamp-1" [matTooltip]="r.descripcion || ''">
              {{ r.descripcion }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef class="text-right">ACCIONES</th>
          <td mat-cell *matCellDef="let r" class="text-right">
            <button mat-icon-button color="primary" (click)="editar(r)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="eliminar(r)">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>
  </section>
</div>
